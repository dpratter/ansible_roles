---
  - name: register swap var
    stat: path={{ swap_location }}
    register: swap_file

  - name: create the file to be used for swap
    command: fallocate -l {{ swap_size }}M {{ swap_location }}
    when: swap_file.stat.exists == False

  - name: format the file for swap
    command: mkswap {{ swap_location }}
    when: swap_file.stat.exists == False

  - name: change swap file permissions
    file: path={{ swap_location }} owner=root group=root mode=0600
    when: swap_file.stat.exists == False

  - name: enable swap
    command: swapon {{ swap_location }}
    when: swap_file.stat.exists == False

  - name: add swap file to /etc/fstab
    lineinfile: dest=/etc/fstab line="{{ swap_location }}   none    swap    sw    0   0" state=present
    when: swap_file.stat.exists == True

